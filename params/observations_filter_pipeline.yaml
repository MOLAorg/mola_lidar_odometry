# Filters:
#
# One filter object will be created for each entry, instancing the given class,
# and with the given parameters. Filters are run in definition order on the
# input metric_map_t object.
#

# Remove points too close, to prevent "noise" from the vehicle, 
# the person next to the robot, etc. Remove too distant points since
# the tiniest angular error projects to a large translational error.
- class_name: mp2p_icp_filters::FilterByRange
  params:
    input_pointcloud_layer: 'raw'
    output_pointcloud_layer: 'filtered'
    keep_between: true # Remove points out of this range limits
    range_min: 4.0
    range_max: 120.0

- class_name: mp2p_icp_filters::FilterDecimateVoxels
  params:
    input_pointcloud_layer: 'filtered'
    output_pointcloud_layer: 'decimated_for_map_insert_finer'
    voxel_filter_resolution: 0.50  # [m]

- class_name: mp2p_icp_filters::FilterDecimateAdaptive
  params:
    input_pointcloud_layer: 'filtered'
    output_pointcloud_layer: 'decimated_for_icp'
    desired_output_point_count: 2000
    # These are used to automatically estimate the voxel size:
    maximum_voxel_count_per_dimension: 150
    #assumed_minimum_pointcloud_bbox: 10.0 # [m]

# Remove layers to save memory and log file storage
- class_name: mp2p_icp_filters::FilterDeleteLayer
  params:
    pointcloud_layer_to_remove: ['raw', 'filtered']
